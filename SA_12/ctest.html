<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
  <meta name="generator" content="Jekyll v3.8.5">

  <title>購物車 ｜ NCU MIS SA</title>

  <!-- Bootstrap core CSS -->
  <link href="statics/css/bootstrap.min.css" rel="stylesheet">
  <link href="statics/css/font-awesome.min.css" rel="stylesheet">
  <link href="statics/icon/favicon.ico" type="image/x-icon" rel="icon">
  <link href="statics/icon/favicon.ico" type="image/x-icon" rel="shortcut icon">


  <style>
    .bd-placeholder-img {
      font-size: 1.125rem;
      text-anchor: middle;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    @media (min-width: 768px) {
      .bd-placeholder-img-lg {
        font-size: 3.5rem;
      }
    }
  </style>
  <!-- Custom styles for this template -->
  <link href="statics/css/product.css" rel="stylesheet">
  <link href="statics/css/jquery-confirm.css" rel="stylesheet">

  <script src="statics/js/jquery-3.4.1.min.js"></script>
  <script src="statics/js/jquery-confirm.js"></script>
</head>
<body>
	<div class="container">
	  <div class="py-5">
	  	<div class='row'>
		  	<div class="col-md-4 order-md-2 mb-4">
		      <h4 class="d-flex justify-content-between align-items-center mb-3">
		        <span class="text-muted">總計</span>
		        <span id="date" class="badge badge-secondary badge-pill">YYYY/MM/DD</span>
		      </h4>
		      <ul class="list-group mb-3">
		        <li class="list-group-item d-flex justify-content-between lh-condensed">
		          <div>
		            <h6 class="my-0">品項數量</h6>
		            <small class="text-muted">Items</small>
		          </div>
		          <span id="total_item" class="text-muted">0</span>
		        </li>
		        <li class="list-group-item d-flex justify-content-between bg-light">
		          <div class="text-success">
		            <h6 class="my-0">產品總量</h6>
		            <small>Quantities</small>
		          </div>
		          <span id="total_quantity" class="text-success">0</span>
		        </li>
		        <li class="list-group-item d-flex justify-content-between">
		          <span>Total (USD)</span>
		          <strong>$ <span id="summary">0.00</span></strong>
		        </li>
		      </ul>
		      <button id="check" class="btn btn-primary btn-lg btn-block" type="button">結帳</button>
		      <button id="clean" class="btn btn-dark btn-lg btn-block" type="button">清空購物車</button>
		      <h4 class="mt-3 mb-3">付款方式</h4>
		      <hr class="mb-4">
		    
		    <form name="form1" method="post" action="">  
	        <div class="row">
	        	<div class="col-md-3 mb-2">
	          		<label for="address">線上付款</label>
	          		<input type="radio" id="a1" name="pay" value="onlinepay" >
	        	</div>
	        	<div class="col-md-3 mb-4">
	          		<label for="address">到場付款</label>
	          		<input type="radio" id="a2" name="pay" value="scenepay">
	          	</div>
	          	
	          	<div id='onlinepay' style="display: none;" class="form">
  					<div class="text-center">
    					<h4>線上付款</h4>
  					</div>
  					<div class="input-group mb-3">
    					<div class="input-group-prepend">
      						<span class="input-group-text">信用卡卡號</span>
    					</div>
    						<input type="text" class="form-control" id="card_no" >
  					</div>
  					<div class="input-group mb-3">
    					<div class="input-group-prepend">
      						<span class="input-group-text">月</span>
    					</div>
    					<input type="text" class="form-control" id="card_month" placeholder="輸入月份" >
    					<div class="input-group-prepend">
      						<span class="input-group-text">年</span>
    					</div>
    					<input type="text" class="form-control" id="card_year" placeholder="輸入年" >
    					<div class="input-group-prepend">
      						<label class="input-group-text">末三碼</label>
    					</div>
    					<input type="text" class="form-control" id="csv" placeholder="輸入末三碼" >
  					</div>
  					<div class="form-group">
    					<span style="color: #fc3762;" id="domestic-card-error"></span>
  					</div>
  				</div>
  
  				<div id='scenepay' style="display: none;" class="form">
  					<div class="text-center">
    					<h4>到場付款</h4>
  					</div>
  					<div class="input-group mb-3">
    					<div class="input-group-prepend">
      						<span class="input-group-text">國外信用卡卡號</span>
    					</div>
    					<input type="text" class="form-control" id="card_no" >
  					</div>
  					<div class="input-group mb-3">
    					<div class="input-group-prepend">
      						<span class="input-group-text">月</span>
    					</div>
    					<input type="text" class="form-control" id="card_month" placeholder="輸入月份" >
    					<div class="input-group-prepend">
      						<span class="input-group-text">年</span>
    					</div>
    					<input type="text" class="form-control" id="card_year" placeholder="輸入年" >
    					<div class="input-group-prepend">
      						<label class="input-group-text">末三碼</label>
    					</div>
    					<input type="text" class="form-control" id="csv" placeholder="輸入末三碼" >
  					</div>
  					<div class="form-group">
    					<span style="color: #fc3762;" id="aboard-card-error"></span>
  					</div>
	        	</div>
	     </form>


	        <h4 class="mb-3">商品資訊</h4>
	        <hr class="mb-4">
	        <div class="row">
				    <div class="table-responsive">
			        <table id="cart_table" class="table table-striped table-sm">
			          <thead>
			            <tr>
			              <th class="text-center" style="width: 10%">商品編號</th>
			              <th class="text-center" style="width: 30%">品名</th>
			              <th class="text-center" style="width: 15%">單價</th>
			              <th class="text-center" style="width: 10%">數量</th>
			              <th class="text-center" style="width: 15%">小計</th>
			              <th class="text-center" style="width: 10%">刪除</th>
			            </tr>
			          </thead>
			          <tbody>
			          </tbody>
			        </table>
			      </div>
		      </div>


    
		    </div>
		   </div>
		  </div>
	</div>
		    
	
</body>
<script>
$('input[type=radio][name="pay"]').on('change', function() {
	  switch($(this).val()) {
	    case 'onlinepay':
	      $("#onlinepay").show();
	      $("#scenepay").hide();
	      break;
	    case 'scenepay':
	      $("#onlinepay").hide();
	      $("#scenepay").show();
	      break;
	  }      
	});//點選付款方式事件切換
	

	    $("#check").click(function () {
	    	
	    	var pay_data = {
	    			"card_no": $("#card_no").val(),
	    			"card_month": $("#card_month").val(),
	    			"card_year": $("#card_year").val(),
	    			"csv": $("#csv").val()
	    	}

	    	// 驗證輸入的資料
	    	pass_vaild = vaild_payData(pay_data);
	    	if (pass_vaild) {
	    		var data_string = JSON.stringify(pay_data);

	    		// 發出POST的AJAX請求
	    		$.ajax({
	    	          type: "POST",
	    	          url: "api/payInfoController.do",
	    	          data: data_string,
	    	          crossDomain: true,
	    	          cache: false,
	    	          dataType: 'json',
	    	          timeout: 5000,
	    	          success: function (response) {
	    	              if(response.status == 200){
	    	              	$.confirm({
	    	                    theme: 'modern',
	    	                    icon: 'fa fa-check-circle-o',
	    	                    type: 'green',
	    	                    animation: 'scale',
	    	                    title: '系統提醒',
	    	                    content: "「購物車結帳成功」，已完成新增訂單！"
	    	                });
	    	              }
	    	          },
	    	          error: function () {
	    	              alert("無法連線到伺服器！");
	    	          }
	    	        });
	    		
	    	}
	    });

	    $("#clean").click(function () {
	    	console.log("[@Action]清空購物車");
	    	cleanAllData();
	    });

	   
	    
	    function vaild_payData(pay_data) {
	    	
	    	var card_no_rule = /^\d{16}$/;
	    	var card_month_rule = /^\d{1,2}$/;
	    	var card_year_rule = /^\d{4}$/;
	    	var csv_rule = /^\d{3}$/;
	    	
	    	if (pay_data["card_no"] == "" || pay_data["card_month"] == "" || pay_data['card_year'] == "" || pay_data['csv'] == "")  alert("必填寫欄位不得有空值！");
	    	else if (pay_data["card_no"] != "" && !card_no_rule.test(pay_data["card_no"])) alert("卡號格式不符！");
	    	else if (pay_data['card_month'] != "" && !card_month_rule.test(pay_data['card_month'])) alert("月格式不符！");
	    	else if (pay_data['card_year'] != "" && !card_year_rule.test(pay_data['card_year'])) alert("年格式不符！");
	    	else if (!csv_rule.test(pay_data['csv'])) alert("安全碼格式不符！");
	    	else {console.log("yes")
	    		return true;}

	    	return false;
	    }
</script>

