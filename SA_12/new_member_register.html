<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>註冊會員</title>
    
   
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>
<body>
    
    <nav class="navbar navbar-expand-lg navbar-light fixed-top" style="background-color: rgba(77,78,84,1);">
        <div class="container" style="height:62px; width: 1170px; margin-right: auto;margin-left: auto;"> 
          <a class="navbar-brand" href="browse.html" style="color:#FFFFFF; font-weight: 600; font-size: 24px;">Tour<span style="color:rgb(0, 216, 255);">Nest</span></a>


            <ul class="navbar-nav    ms-auto">
              <li class="nav-item" style="padding-right:15px;">
                <button type="button" style="color:#FFFFFF; font-size: 16.5px; " class="btn " data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                    刊登家中空房
                  </button>
              </li>
              
              <li class="nav-item" style="padding-right:15px;">
                <a  type="button" href="new_login.html" class="btn" style="color:#FFFFFF; width: 120px;background: rgb(0, 216, 255);
                border-style: solid;font-size: 14px;
                border-color: rgb(0, 216, 255);height: 40px;" >登入</a>
              </li>
            </ul>
        

        </div>
      </nav>
    <div class="container" >
   
        <form class="" style=" padding-top:90px; padding-left: 300px; padding-right: 300px; color:#2a2a2e;">
            <div class="" style="padding-top: 40px; border: 2px; border-color:#dddfe2; padding-left:60px; padding-right: 60px; background-color: #fcfcfc;">
                
                <div class="card-page-header row">
                    <div class="col-sm-6" style="padding-top: 15px;">
                        <h1 class="m-t-0" style="font-size: 24px;font-weight: 700;">想要成為會員嗎?</h1>
                        <p>完成底下的表單，讓我們更了解你吧！</p>
                    </div><div class="hidden-xs col-sm-4">
                        <img class="page-header-icon" width="400" src="//img.agoda.net/images/header/ec-description@2x.png" alt="description page">
                    </div>
                </div>
                <div style="margin-bottom: 42px;">
                    <h2 style="font-size:20px; font-weight: 700;">你的名字</h2>
                        <p class="m-b-4">你的姓名將顯示在訂單的頁面，並不會再評論區喔!</p>
                            <div class="form-group">
                                <div>
                                    <input placeholder="" type="text" id="name" class="form-control" value>
                                </div>
                            </div>
                       
                </div>

                <div style="margin-bottom: 42px;">
                    <h2 style="font-size:20px; font-weight: 700;">你的信箱</h2>
                        <p class="m-b-4">輸入自己最常使用的信箱，以免錯過我們重要的信息喔!</p>
                            <div class="form-group">
                                <div>
                                    <input placeholder="" type="text" id="email" class="form-control" value>
                                </div>
                            </div>
                       
                </div>

                <div style="margin-bottom: 42px;">
                    <h2 style="font-size:20px; font-weight: 700;">你的密碼</h2>
                        <p class="m-b-4">記好自己的密碼，千萬別忘記囉!</p>
                            <div class="form-group">
                                <div>
                                    <input placeholder="" type="password" id="password" class="form-control" value>
                                </div>
                            </div>
                       
                </div>
                <div style="margin-bottom: 42px;">
                    <h2 style="font-size:20px; font-weight: 700;">確認密碼</h2>
                    
                            <div class="form-group">
                                <div>
                                    <input placeholder="" type="password" id="password_c" class="form-control" value>
                                </div>
                            </div>
                       
                </div>

                <div style="margin-bottom: 42px;">
                    <h2 style="font-size:20px; font-weight: 700;">你的電話</h2>
                        <p class="m-b-4">你的電話將顯示在訂單的頁面，讓房東方便聯絡你喔!</p>
                            <div class="form-group">
                                <div>
                                    <input placeholder="" type="text" id="phone" class="form-control" value>
                                </div>
                            </div>
                       
                </div>
                <button type="button" class="mb-5 btn btn-secondary" id="confirm">成為會員</button>
            </div>
        </form> 
        <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title fw-bold" id="staticBackdropLabel">房東登入</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
        
                <div class="tex-center">
                    <form>
                        
                    
                        <div class="form-floating">
                        <input type="email" class="form-control" id="floatingInput" placeholder="name@example.com">
                        <label for="floatingInput">輸入電子信箱</label>
                        </div>
                        <div class="form-floating mb-5">
                        <input type="password" class="form-control" id="floatingPassword" placeholder="Password">
                        <label for="floatingPassword">輸入密碼</label>
                        <p id="alert_panel" style="float:left; font-size:small; color:red;">帳號或密碼錯誤!</p>
                        </div>
                        
                        <div class="row">
                            <div class="col-6">
                                <a class="w-100 btn   btn-outline-danger" href="new_manager_register.html">成為房東</a>
                            </div>
                            <div class="col-6">
                                <button class="w-100 btn  btn-secondary " type="submit">登入</button>
                            </div>
                        </div>
                    </form>
                </div>
        
          
                </div>
                
              </div>
            </div>
          </div>
        
              
    </div>
            
    




 </body>
  
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
 <script>


$(document).ready(function() {   

	var $form = $('#confirm');
	
	$form.click(function() {
	
		submit();
	});

	function submit() {
        var name = $('#name').val();
        var email = $('#email').val();
        var password = $('#password').val();
		var password = $('#password_c').val();
		var phone = $("#phone").val();
        
        var email_rule = /^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$/;
        var password_rule = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/;
		var phone_rule = /^09[0-9]{8}$/;
        
		if (!email_rule.test(email)) {
            alert("Email格式不符！");
        }
        //else if(password!=password_c){
        //	alert("請輸入相同密碼");
        //}
        else if(!password_rule.test(password)) {
            alert("密碼格式不符，長度至少8，且至少包含一個數字和英文字母！");
        }
        else if(!phone_rule.test(phone)){
        	alert("電話號碼格式錯誤!");
        }
        else {
        	
            // 將資料組成JSON格式
            var data_object = {
                "name": name,
                "email": email,
                "password": password,
                "phone": phone
            };

            // 將JSON格式轉換成字串
            var data_string = JSON.stringify(data_object);

            // 發出POST的AJAX請求
            $.ajax({
                    type: "POST",
                    url: "api/MemberController.do",
                    data: data_string,
                    crossDomain: true,
                    cache: false,
                    dataType: 'json',
                    timeout: 5000,
                    success: function (response) {
                    	alert("註冊成功")
                    	getMember(name)
                    	
                    },
                    error: function () {
                        alert("無法連線到伺服器！");
                    }
            });
        }
    }
});

function getMember(name){
	$.ajax({
        type: "GET",
        url: "api/MemberController.do",
        crossDomain: true,
        cache: false,
        dataType: 'json',
        timeout: 5000,
        success: function (response) {
          if (response.status == 200) {
        	
        	
        	$.each(response.response.data, function (){
        		if(this.name == name){
	        		sessionStorage.setItem("member_id",this.id);    
					sessionStorage.setItem("member_name",this.name); 
					sessionStorage.setItem("member_phone",this.phone); 
					sessionStorage.setItem("member_email",this.email); 
			        location.href = "new_member.html";
        		}
        	})     	
          }
        },
        error: function () {
          alert("無法連線到伺服器！");
        }
      });
}

</script>
</html>